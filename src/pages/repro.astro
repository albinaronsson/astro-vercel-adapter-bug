---
import { Picture } from "astro:assets";
import testImg from "../assets/test.jpg";

const imgString = testImg.src;                 // e.g. "/_astro/test.ABC123.jpg"
const good = `/_vercel/image?url=${encodeURIComponent(imgString)}&w=800&q=80&cb=good`;
const bad  = `/_vercel/image?url=${encodeURIComponent(imgString.slice(1))}&w=800&q=80&cb=bad`; // intentionally missing leading "/"
---

<h1>Vercel Image Optimization Repro</h1>

<h2>Case A — ESM ImageMetadata (adapter path; historically fails)</h2>
<Picture src={testImg} widths={[800]} formats={["jpeg"]} sizes="100vw" />

<h2>Case B — Plain IMG (known-bad URL, missing %2F)</h2>
<p><code>{bad}</code></p>
<img src={bad} alt="bad-url" width="800" height="480" />

<h2>Case C — Plain IMG (good URL, includes %2F)</h2>
<p><code>{good}</code></p>
<img src={good} alt="good-url" width="800" height="480" />
